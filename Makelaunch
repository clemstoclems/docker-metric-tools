launch_scan:
ifeq ($(url),)
	@echo "$(ccred) Please provide an url to scan ! $(ccend)"
else
	make launch_yellow_lab_scan url=$(url)
endif

launch_yellow_lab_scan:
	curl -X POST -H "Content-Type: application/json" -d '{"url":"${url}", "waitForResponse":"true"}' "localhost:8383/api/runs" | sed 's/Found. Redirecting to *//' >> data/measures/path_${url}.txt
	make get_results_api file=data/measures/path_${url}.txt
	rm data/measures/path_${url}.txt

get_results_api:
	curl -s "localhost:8383$$(cat ${file})" >> data/measures/result_${url}.json
	cat data/measures/result_${url}.json | python -c "import sys, json; print json.load(sys.stdin)['scoreProfiles']['generic']['globalScore']" >> data/measures/score_${url}.txt
	rm data/measures/result_${url}.json
	./scripts/insert_data.sh
