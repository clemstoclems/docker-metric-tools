launch_scan:
ifeq ($(url),)
	@echo "$(ccred) Please provide an url to scan as url=UrlToScan ! $(ccend)"
else
	make launch_yellow_lab_scan url=$(url)
endif

launch_yellow_lab_scan:
	curl -X POST -H "Content-Type: application/json" -d '{"url":"${url}", "waitForResponse":"true"}' "yellowlab_omnitools:8383/api/runs" | sed 's/Found. Redirecting to *//' >> data/measures/path_${url}.txt
	make get_results_api file=data/measures/path_${url}.txt
	rm data/measures/path_${url}.txt

get_results_api:
	#Global score
	curl -s "yellowlab_omnitools:8383$$(cat ${file})" >> data/measures/result_${url}.json
	
	cat data/measures/result_${url}.json | python2.7 -c "import sys, json; print json.load(sys.stdin)['scoreProfiles']['generic']['globalScore']" >> data/measures/global_score_${url}.txt

	cat data/measures/result_${url}.json | python2.7 -c "import sys, json; print json.load(sys.stdin)['scoreProfiles']['generic']['categories']['pageWeight']['categoryScore']" >> data/measures/pageweight_score_${url}.txt
	
	cat data/measures/result_${url}.json | python2.7 -c "import sys, json; print json.load(sys.stdin)['scoreProfiles']['generic']['categories']['requests']['categoryScore']" >> data/measures/requests_score_${url}.txt

	cat data/measures/result_${url}.json | python2.7 -c "import sys, json; print json.load(sys.stdin)['scoreProfiles']['generic']['categories']['domManipulations']['categoryScore']" >> data/measures/dommanipulations_score_${url}.txt

	cat data/measures/result_${url}.json | python2.7 -c "import sys, json; print json.load(sys.stdin)['scoreProfiles']['generic']['categories']['badCSS']['categoryScore']" >> data/measures/badcss_score_${url}.txt

	#Page weight Score
	#@echo ${MESURES}
	#IFS=',' && \
	#for mesure in $${MESURES}; do \
	#	@echo mesure; \
	#done
	
	rm data/measures/result_${url}.json
	./scripts/insert_data.sh ${url}
